---
phase: 01-frontend-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/ui/Button.tsx
  - src/components/ui/Select.tsx
  - src/hooks/useImageUpload.ts
  - src/components/upload/ImageUploader.tsx
  - src/components/upload/ImagePreviewGrid.tsx
autonomous: true

must_haves:
  truths:
    - "User can click upload area to open file browser"
    - "User can select 1-3 JPG/PNG images"
    - "User sees preview thumbnails of uploaded images"
    - "User can remove individual uploaded images"
    - "Dropdown select shows options and allows selection"
  artifacts:
    - path: "src/components/ui/Button.tsx"
      provides: "Reusable button component"
      exports: ["Button"]
    - path: "src/components/ui/Select.tsx"
      provides: "Headless UI Listbox wrapper"
      exports: ["Select"]
    - path: "src/hooks/useImageUpload.ts"
      provides: "Image upload state management"
      exports: ["useImageUpload"]
    - path: "src/components/upload/ImageUploader.tsx"
      provides: "react-dropzone upload zone"
      exports: ["ImageUploader"]
    - path: "src/components/upload/ImagePreviewGrid.tsx"
      provides: "Image preview grid with remove"
      exports: ["ImagePreviewGrid"]
  key_links:
    - from: "src/components/upload/ImageUploader.tsx"
      to: "react-dropzone"
      via: "useDropzone hook"
      pattern: "useDropzone"
    - from: "src/hooks/useImageUpload.ts"
      to: "URL.createObjectURL"
      via: "preview URL creation"
      pattern: "createObjectURL"
    - from: "src/hooks/useImageUpload.ts"
      to: "URL.revokeObjectURL"
      via: "cleanup on unmount"
      pattern: "revokeObjectURL"
    - from: "src/components/ui/Select.tsx"
      to: "@headlessui/react"
      via: "Listbox components"
      pattern: "Listbox"
---

<objective>
Build the reusable UI components (Button, Select) and the complete image upload system with preview functionality.

Purpose: Create the core interactive components that handle user input. The upload system is the primary user interaction point and must handle file selection, validation, preview, and removal.
Output: Working Button and Select components, plus a complete image upload system with hook, upload zone, and preview grid.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-frontend-foundation/01-RESEARCH.md
@.planning/phases/01-frontend-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UI primitive components (Button, Select)</name>
  <files>
    - src/components/ui/Button.tsx
    - src/components/ui/Select.tsx
  </files>
  <action>
Create reusable UI components:

1. src/components/ui/Button.tsx - Simple button with variants:
```tsx
import { ButtonHTMLAttributes } from 'react';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary';
  isLoading?: boolean;
}

export function Button({
  children,
  variant = 'primary',
  isLoading = false,
  disabled,
  className = '',
  ...props
}: ButtonProps) {
  const baseStyles = 'px-6 py-3 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2';

  const variants = {
    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 disabled:bg-blue-300',
    secondary: 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-500 disabled:bg-gray-100'
  };

  return (
    <button
      className={`${baseStyles} ${variants[variant]} ${className}`}
      disabled={disabled || isLoading}
      {...props}
    >
      {isLoading ? 'Kraunama...' : children}
    </button>
  );
}
```

2. src/components/ui/Select.tsx - Headless UI Listbox wrapper:
```tsx
import { Listbox, ListboxButton, ListboxOption, ListboxOptions } from '@headlessui/react';

interface SelectProps<T> {
  value: T | null;
  onChange: (value: T) => void;
  options: readonly T[];
  getLabel: (option: T) => string;
  placeholder?: string;
  label?: string;
}

export function Select<T>({
  value,
  onChange,
  options,
  getLabel,
  placeholder = 'Pasirinkite...',
  label
}: SelectProps<T>) {
  return (
    <div className="w-full">
      {label && (
        <label className="block text-sm font-medium text-gray-700 mb-1">
          {label}
        </label>
      )}
      <Listbox value={value} onChange={onChange}>
        <div className="relative">
          <ListboxButton className="relative w-full cursor-pointer rounded-lg border border-gray-300 bg-white py-3 pl-4 pr-10 text-left shadow-sm hover:border-gray-400 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
            <span className={value ? 'text-gray-900' : 'text-gray-500'}>
              {value ? getLabel(value) : placeholder}
            </span>
            <span className="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
              <svg className="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                <path fillRule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clipRule="evenodd" />
              </svg>
            </span>
          </ListboxButton>
          <ListboxOptions
            anchor="bottom"
            className="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-lg bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
          >
            {options.map((option, index) => (
              <ListboxOption
                key={index}
                value={option}
                className="relative cursor-pointer select-none py-3 pl-4 pr-9 text-gray-900 data-[focus]:bg-blue-50 data-[selected]:bg-blue-100"
              >
                {getLabel(option)}
              </ListboxOption>
            ))}
          </ListboxOptions>
        </div>
      </Listbox>
    </div>
  );
}
```

IMPORTANT: Use Headless UI v2 syntax (ListboxButton, ListboxOption, etc.) NOT v1 syntax (Listbox.Button).
  </action>
  <verify>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Files exist at correct paths
3. Components use proper Headless UI v2 imports
  </verify>
  <done>
Button component created with primary/secondary variants and loading state. Select component created as generic Headless UI Listbox wrapper with label support and proper styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create image upload system (hook + components)</name>
  <files>
    - src/hooks/useImageUpload.ts
    - src/components/upload/ImageUploader.tsx
    - src/components/upload/ImagePreviewGrid.tsx
  </files>
  <action>
Create the complete image upload system:

1. src/hooks/useImageUpload.ts - Custom hook for upload state:
```typescript
import { useState, useCallback, useEffect, useRef } from 'react';
import type { UploadedImage } from '../types';

const MAX_FILES = 3;
const ACCEPTED_TYPES = ['image/jpeg', 'image/png'];

export function useImageUpload() {
  const [images, setImages] = useState<UploadedImage[]>([]);
  const previewUrlsRef = useRef<string[]>([]);

  // Cleanup ALL preview URLs on unmount - CRITICAL for memory management
  useEffect(() => {
    return () => {
      previewUrlsRef.current.forEach(url => URL.revokeObjectURL(url));
    };
  }, []);

  const addImages = useCallback((files: File[]) => {
    // Filter to only valid types and respect max limit
    const validFiles = files
      .filter(f => ACCEPTED_TYPES.includes(f.type))
      .slice(0, MAX_FILES - images.length);

    if (validFiles.length === 0) return;

    const newImages: UploadedImage[] = validFiles.map(file => {
      const previewUrl = URL.createObjectURL(file);
      previewUrlsRef.current.push(previewUrl);
      return { file, previewUrl };
    });

    setImages(prev => [...prev, ...newImages].slice(0, MAX_FILES));
  }, [images.length]);

  const removeImage = useCallback((index: number) => {
    setImages(prev => {
      const removed = prev[index];
      if (removed) {
        URL.revokeObjectURL(removed.previewUrl);
        previewUrlsRef.current = previewUrlsRef.current.filter(
          url => url !== removed.previewUrl
        );
      }
      return prev.filter((_, i) => i !== index);
    });
  }, []);

  const clearImages = useCallback(() => {
    images.forEach(img => URL.revokeObjectURL(img.previewUrl));
    previewUrlsRef.current = [];
    setImages([]);
  }, [images]);

  return {
    images,
    addImages,
    removeImage,
    clearImages,
    canAddMore: images.length < MAX_FILES,
    imageCount: images.length,
    hasImages: images.length > 0
  };
}
```

2. src/components/upload/ImageUploader.tsx - Dropzone component:
```tsx
import { useDropzone } from 'react-dropzone';
import { UI_TEXT } from '../../constants/ui';

interface ImageUploaderProps {
  onFilesSelected: (files: File[]) => void;
  disabled?: boolean;
  canAddMore: boolean;
}

export function ImageUploader({ onFilesSelected, disabled, canAddMore }: ImageUploaderProps) {
  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    accept: {
      'image/jpeg': ['.jpg', '.jpeg'],
      'image/png': ['.png']
    },
    maxFiles: 3,
    disabled: disabled || !canAddMore,
    onDrop: onFilesSelected
  });

  const isDisabled = disabled || !canAddMore;

  return (
    <div
      {...getRootProps()}
      className={`
        border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200
        ${isDragActive
          ? 'border-blue-500 bg-blue-50'
          : 'border-gray-300 hover:border-gray-400 bg-gray-50'
        }
        ${isDisabled
          ? 'opacity-50 cursor-not-allowed'
          : 'cursor-pointer hover:bg-gray-100'
        }
      `}
    >
      <input {...getInputProps()} />
      <div className="space-y-2">
        <div className="text-4xl">ðŸ“·</div>
        <p className="text-gray-700 font-medium">
          {UI_TEXT.upload.description}
        </p>
        <p className="text-sm text-gray-500">
          {UI_TEXT.upload.hint}
        </p>
        {!canAddMore && (
          <p className="text-sm text-amber-600 font-medium">
            Maksimalus nuotrauku skaicius pasiektas
          </p>
        )}
      </div>
    </div>
  );
}
```

3. src/components/upload/ImagePreviewGrid.tsx - Preview with remove:
```tsx
import type { UploadedImage } from '../../types';
import { UI_TEXT } from '../../constants/ui';

interface ImagePreviewGridProps {
  images: UploadedImage[];
  onRemove: (index: number) => void;
}

export function ImagePreviewGrid({ images, onRemove }: ImagePreviewGridProps) {
  if (images.length === 0) return null;

  return (
    <div className="grid grid-cols-3 gap-4 mt-4">
      {images.map((image, index) => (
        <div key={image.previewUrl} className="relative group">
          <img
            src={image.previewUrl}
            alt={`${UI_TEXT.upload.imageOf} ${index + 1}`}
            className="w-full aspect-square object-cover rounded-lg shadow-sm"
          />
          <button
            type="button"
            onClick={() => onRemove(index)}
            className="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-red-600 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
            aria-label={`${UI_TEXT.upload.remove} ${UI_TEXT.upload.imageOf} ${index + 1}`}
          >
            Ã—
          </button>
          <div className="absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
            {index + 1}/3
          </div>
        </div>
      ))}
    </div>
  );
}
```

CRITICAL: The useImageUpload hook MUST call URL.revokeObjectURL on cleanup to prevent memory leaks. This is implemented in both the useEffect cleanup AND in removeImage.
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. All files exist at correct paths
3. useImageUpload hook has cleanup in useEffect return
4. ImageUploader uses react-dropzone properly
5. ImagePreviewGrid renders images with remove buttons
  </verify>
  <done>
Complete image upload system created:
- useImageUpload hook manages state with proper memory cleanup (revokeObjectURL)
- ImageUploader wraps react-dropzone with JPG/PNG accept, max 3 files
- ImagePreviewGrid displays thumbnails with remove buttons and numbered overlay
All components use Lithuanian UI text from constants.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. `npx tsc --noEmit` passes with no errors
2. Directory structure exists:
   - src/components/ui/Button.tsx
   - src/components/ui/Select.tsx
   - src/hooks/useImageUpload.ts
   - src/components/upload/ImageUploader.tsx
   - src/components/upload/ImagePreviewGrid.tsx
3. All components export named exports (not default)
4. useImageUpload hook includes URL.revokeObjectURL in cleanup
5. Select uses Headless UI v2 syntax
6. ImageUploader uses react-dropzone useDropzone hook
</verification>

<success_criteria>
- All 5 files created with correct TypeScript types
- No TypeScript compilation errors
- useImageUpload properly manages object URLs (create + revoke)
- ImageUploader accepts only JPG/PNG, max 3 files
- ImagePreviewGrid shows grid with remove functionality
- Select component works as generic Listbox wrapper
- Button supports primary/secondary variants and loading state
- Ready for Plan 03 to use Select in ConfigPanel
</success_criteria>

<output>
After completion, create `.planning/phases/01-frontend-foundation/01-02-SUMMARY.md`
</output>
