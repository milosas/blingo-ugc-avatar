---
phase: 03-integration-and-results
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - package.json
  - src/components/generation/ResultsGallery.tsx
  - src/components/generation/ResultsActions.tsx
  - src/utils/download.ts
autonomous: true

must_haves:
  truths:
    - "3 generated images display in responsive grid (3-col desktop, 1-col mobile)"
    - "Each image shows angle label (Toli, Arti, Labai arti)"
    - "Click on image opens fullscreen lightbox"
    - "Each image has individual download button"
    - "Regeneruoti button exists and is clickable"
    - "Naujas upload button exists and is clickable"
  artifacts:
    - path: "src/components/generation/ResultsGallery.tsx"
      provides: "3-image grid with lightbox and download buttons"
      exports: ["ResultsGallery"]
    - path: "src/components/generation/ResultsActions.tsx"
      provides: "Regenerate and new upload action buttons"
      exports: ["ResultsActions"]
    - path: "src/utils/download.ts"
      provides: "Image download utility function"
      exports: ["downloadImage"]
  key_links:
    - from: "src/components/generation/ResultsGallery.tsx"
      to: "yet-another-react-lightbox"
      via: "Lightbox component import"
      pattern: "import.*Lightbox.*yet-another-react-lightbox"
    - from: "src/components/generation/ResultsGallery.tsx"
      to: "src/utils/download.ts"
      via: "downloadImage function call"
      pattern: "downloadImage\\("
---

<objective>
Create the results gallery with lightbox functionality, download capability, and action buttons for regenerate/new upload flows.

Purpose: Display generated images professionally with click-to-expand, individual downloads, and clear action paths for the user after generation completes.

Output: ResultsGallery component with Yet Another React Lightbox, ResultsActions component, and download utility.
</objective>

<execution_context>
@C:\Users\milos\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\milos\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-integration-and-results/03-CONTEXT.md
@.planning/phases/03-integration-and-results/03-RESEARCH.md
@src/types/generation.ts
@src/constants/ui.ts
@src/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install lightbox and create download utility</name>
  <files>package.json, src/utils/download.ts</files>
  <action>
1. Install yet-another-react-lightbox:
   npm install yet-another-react-lightbox

2. Create src/utils/download.ts with downloadImage function:
   - Parameters: (url: string, filename: string)
   - Sanitize filename: replace non-alphanumeric chars (except . and -) with underscore, limit to 255 chars
   - Create anchor element with href=url and download=filename
   - Append to body, click, remove from body
   - Export the function

Note: This uses the anchor download pattern (not fetch+blob) per research - simpler and works for external URLs.
  </action>
  <verify>
Check package.json includes "yet-another-react-lightbox".
Check src/utils/download.ts exports downloadImage function.
Run `npm install` if needed, then `npx tsc --noEmit`.
  </verify>
  <done>
yet-another-react-lightbox installed, downloadImage utility created with filename sanitization.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ResultsGallery component</name>
  <files>src/components/generation/ResultsGallery.tsx</files>
  <action>
Create src/components/generation/ResultsGallery.tsx:

1. Props: { images: GeneratedImage[] }

2. State:
   - lightboxOpen: boolean
   - currentIndex: number

3. Constants:
   - angleLabels: { far: 'Toli', medium: 'Arti', close: 'Labai arti' }

4. Layout (per CONTEXT.md):
   - Responsive grid: grid grid-cols-1 md:grid-cols-3 gap-4
   - Each image in relative container with group class for hover effects

5. For each image:
   - img element: w-full h-auto rounded-lg cursor-pointer transition-transform hover:scale-[1.02]
   - Click handler: set currentIndex and open lightbox
   - Angle label overlay: absolute bottom-2 left-2 bg-black/60 text-white px-3 py-1 rounded text-sm
   - Download button overlay: absolute top-2 right-2, white/90 bg, rounded, icon (use arrow down or simple text)
     - onClick calls downloadImage(image.url, `rezultatas-${angleLabels[image.angle]}.jpg`)

6. Lightbox:
   - Import Lightbox from "yet-another-react-lightbox"
   - Import "yet-another-react-lightbox/styles.css"
   - Props: open, close, index, slides (map images to { src: url })

7. Add fade-in animation on mount for the reveal effect (per CONTEXT.md: "instant reveal when complete")
  </action>
  <verify>
Run `npx tsc --noEmit` - should pass.
Check imports for Lightbox and styles.css.
  </verify>
  <done>
ResultsGallery displays 3 images in responsive grid with angle labels, download buttons, and click-to-expand lightbox.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create ResultsActions component</name>
  <files>src/components/generation/ResultsActions.tsx, src/constants/ui.ts</files>
  <action>
1. Update src/constants/ui.ts to add:
   - actions.regenerate: 'Regeneruoti'
   - actions.newUpload: 'Naujas upload'
   - results.title: 'Sugeneruotos nuotraukos' (optional, for section header)

2. Create src/components/generation/ResultsActions.tsx:

Props: { onRegenerate: () => void, onNewUpload: () => void }

Layout (per CONTEXT.md: "Action buttons placed below results"):
- Flex container with gap: flex flex-col sm:flex-row gap-4 mt-8
- Two buttons using the existing Button component

Regenerate button:
- Primary style (default Button styling)
- Full width on mobile, auto on desktop
- Text: UI_TEXT.actions.regenerate
- onClick: onRegenerate

New Upload button:
- Secondary/outline style (add variant prop to Button if needed, or use different classes)
- Full width on mobile, auto on desktop
- Text: UI_TEXT.actions.newUpload
- onClick: onNewUpload

IMPORTANT: No confirmation dialogs per CONTEXT.md - both actions are immediate.
  </action>
  <verify>
Run `npx tsc --noEmit` - should pass.
Check UI_TEXT has new action texts.
  </verify>
  <done>
ResultsActions provides Regeneruoti and Naujas upload buttons with proper styling and callbacks.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm install` completes successfully
2. `npx tsc --noEmit` passes
3. yet-another-react-lightbox in package.json dependencies
4. All components export correctly
5. Download utility handles filename sanitization
</verification>

<success_criteria>
- Lightbox library installed and importable
- ResultsGallery shows 3-column grid on desktop, stacked on mobile
- Each image has angle label overlay and download button
- Clicking image opens fullscreen lightbox
- Download button triggers file download with sanitized filename
- ResultsActions provides regenerate and new upload buttons
- All text is in Lithuanian from UI_TEXT constants
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-and-results/03-02-SUMMARY.md`
</output>
